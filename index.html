<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Study Suite</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:ital,wght@0,600;1,600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-body: #f8f9fa;
            --bg-card: #ffffff;
            --text-main: #1a1a1a;
            --text-sub: #666666;
            --border: #e0e0e0;
            --accent: #1a1a1a;
            --shadow: 0 10px 30px rgba(0,0,0,0.05);
            --radius: 12px;
            --font-serif: 'Playfair Display', serif;
            --font-sans: 'Inter', sans-serif;
        }

        [data-theme="dark"] {
            --bg-body: #121212;
            --bg-card: #1e1e1e;
            --text-main: #ffffff;
            --text-sub: #a0a0a0;
            --border: #333333;
            --accent: #ffffff;
            --shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease; }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: var(--font-sans);
            display: flex;
            justify-content: center;
            min-height: 100vh;
            padding: 40px 20px;
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        /* Í≥µÌÜµ Ïπ¥Îìú Ïä§ÌÉÄÏùº */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        /* 1. Ìó§Îçî & Ïù¥ÎØ∏ÏßÄ */
        header { 
            position: relative; 
            border-radius: var(--radius); 
            overflow: hidden; 
            box-shadow: var(--shadow);
        }
        
        .header-image { 
            width: 100%; 
            height: 200px; 
            object-fit: cover; 
            display: block; 
            filter: grayscale(100%); /* Ïù¥ÎØ∏ÏßÄÎ•º ÌùëÎ∞±ÏúºÎ°ú */
            transition: filter 0.5s;
        }
        
        header:hover .header-image { filter: grayscale(0%); } /* Ìò∏Î≤ÑÏãú Ïª¨Îü¨ Î≥µÍµ¨ */

        .header-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            padding: 20px;
            color: white;
        }

        .app-title {
            font-family: var(--font-serif);
            font-size: 24px;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .quote {
            font-size: 12px;
            opacity: 0.8;
            font-style: italic;
            margin-top: 5px;
        }

        .theme-toggle {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            z-index: 10;
        }

        /* ÏÑπÏÖò Ï†úÎ™© */
        h2 {
            font-family: var(--font-sans);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-sub);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }

        /* 2. ÎåÄÏãúÎ≥¥Îìú Í∑∏Î¶¨Îìú */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .stat-box { text-align: center; }
        .stat-val { font-family: var(--font-serif); font-size: 32px; font-weight: 600; margin: 10px 0; }
        .stat-label { font-size: 11px; text-transform: uppercase; color: var(--text-sub); letter-spacing: 1px; }

        /* Ïä§Ìä∏Î¶≠ (Î∂àÍΩÉ ÏïÑÏù¥ÏΩò) */
        .streak-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            background: var(--bg-body);
            padding: 4px 10px;
            border-radius: 20px;
            margin-top: 5px;
            font-weight: 600;
        }

        /* 3. ÌÉÄÏù¥Î®∏ & ÎÖ∏Ïù¥Ï¶à */
        .timer-display {
            font-family: var(--font-serif);
            font-size: 56px;
            text-align: center;
            font-variant-numeric: tabular-nums;
            margin: 20px 0;
            letter-spacing: -1px;
        }

        .btn-group { display: flex; justify-content: center; gap: 10px; }

        button {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 10px 20px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            border-radius: 30px;
            font-weight: 600;
        }

        button:hover { background: var(--text-main); color: var(--bg-card); border-color: var(--text-main); }
        button.active { background: var(--text-main); color: var(--bg-card); border-color: var(--text-main); }

        .noise-control {
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 12px;
            color: var(--text-sub);
            background: var(--bg-body);
            padding: 10px;
            border-radius: 8px;
        }

        /* 4. Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ */
        .input-wrapper { display: flex; gap: 10px; margin-bottom: 20px; }
        
        input[type="text"], select, textarea {
            width: 100%;
            background: transparent;
            border: none;
            border-bottom: 1px solid var(--border);
            padding: 10px;
            font-family: var(--font-sans);
            font-size: 14px;
            color: var(--text-main);
            outline: none;
        }
        
        input[type="text"]:focus, textarea:focus { border-bottom-color: var(--text-main); }
        
        .tag-select { width: 80px; font-size: 12px; border: 1px solid var(--border); border-radius: 4px; padding: 5px; background: var(--bg-card); color: var(--text-main); }

        ul { list-style: none; }
        li {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
            animation: fadeIn 0.3s ease;
        }
        li:last-child { border-bottom: none; }
        li.completed span { text-decoration: line-through; color: var(--text-sub); opacity: 0.6; }

        .check-circle {
            width: 18px;
            height: 18px;
            border: 1px solid var(--text-sub);
            border-radius: 50%;
            margin-right: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .check-circle.checked { background: var(--text-main); border-color: var(--text-main); }
        .check-circle.checked::after { content: '‚úì'; color: var(--bg-card); font-size: 10px; }

        .tag-pill {
            font-size: 9px;
            padding: 3px 8px;
            border-radius: 10px;
            background: var(--bg-body);
            color: var(--text-sub);
            margin-right: 8px;
            font-weight: 600;
        }

        /* 5. Î©îÎ™® & Î°úÍ∑∏ */
        textarea { border: 1px solid var(--border); border-radius: 8px; resize: vertical; min-height: 120px; background: var(--bg-body); margin-top: 10px;}
        
        .log-container {
            font-size: 12px;
            color: var(--text-sub);
            max-height: 100px;
            overflow-y: auto;
        }
        .log-row { display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px dashed var(--border); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

    <div class="container">
        
        <header>
            <button class="theme-toggle" onclick="toggleTheme()">‚óë</button>
            <img src="image.png" alt="Cover" class="header-image" onerror="this.style.display='none'">
            <div class="header-overlay">
                <div class="app-title">Study Protocol</div>
                <div class="quote" id="dailyQuote">"Stay hungry, stay foolish."</div>
            </div>
        </header>

        <div class="dashboard-grid">
            <div class="card stat-box">
                <div class="stat-label">D-Day Goal</div>
                <input type="date" id="ddayInput" style="font-size:10px; text-align:center; margin-bottom:5px; border:none; background:transparent; color:var(--text-sub);">
                <div class="stat-val" id="ddayDisplay">-</div>
            </div>
            <div class="card stat-box">
                <div class="stat-label">Study Streak</div>
                <div class="stat-val" style="font-size:28px;" id="streakDisplay">0</div>
                <div class="streak-badge">üî• Days in a row</div>
            </div>
        </div>

        <div class="card">
            <h2>
                Focus Session
                <div class="btn-group" style="gap:5px;">
                    <button id="modeStopwatch" class="active" onclick="setMode('stopwatch')" style="padding:4px 10px; font-size:10px;">Count Up</button>
                    <button id="modePomodoro" onclick="setMode('pomodoro')" style="padding:4px 10px; font-size:10px;">Pomodoro</button>
                </div>
            </h2>
            
            <div class="timer-display" id="timerDisplay">00:00:00</div>
            
            <div class="btn-group">
                <button onclick="timerAction('start')">Play</button>
                <button onclick="timerAction('pause')">Pause</button>
                <button onclick="timerAction('reset')">Reset</button>
            </div>

            <div class="noise-control">
                <span>üéß Deep Focus Noise (Brownian)</span>
                <button id="noiseBtn" onclick="toggleNoise()" style="padding:4px 10px; border-radius:4px;">OFF</button>
            </div>
        </div>

        <div class="card">
            <h2>Tasks <span id="taskCount" style="font-size:10px; color:var(--text-sub);">(0/0)</span></h2>
            <div class="input-wrapper">
                <select id="todoTag" class="tag-select">
                    <option value="CORE">Ï£ºÏöî</option>
                    <option value="LANG">Ïñ∏Ïñ¥</option>
                    <option value="REV">Î≥µÏäµ</option>
                    <option value="ETC">Í∏∞ÌÉÄ</option>
                </select>
                <input type="text" id="todoInput" placeholder="Ìï† ÏùºÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî...">
                <button onclick="addTodo()" style="padding:0 15px;">+</button>
            </div>
            <ul id="todoList"></ul>
        </div>

        <div class="card">
            <h2>Memo & Log</h2>
            <div class="log-container" id="logList"></div>
            <textarea id="memoPad" placeholder="Îñ†Ïò§Î•¥Îäî ÏïÑÏù¥ÎîîÏñ¥Î•º Í∏∞Î°ùÌïòÏÑ∏Ïöî."></textarea>
        </div>

    </div>

    <script>
        // --- State ---
        let state = {
            todos: [],
            logs: [],
            timer: { time: 0, isRunning: false, mode: 'stopwatch', interval: null },
            streak: { count: 0, lastDate: null },
            dday: null
        };

        const QUOTES = [
            "The best way to predict the future is to create it.",
            "It always seems impossible until it's done.",
            "Don‚Äôt stop when you‚Äôre tired. Stop when you‚Äôre done.",
            "Dream big and dare to fail.",
            "Action is the foundational key to all success."
        ];

        // --- Init ---
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            renderAll();
            checkStreak();
            
            // ÎûúÎç§ Î™ÖÏñ∏
            document.getElementById('dailyQuote').innerText = `"${QUOTES[Math.floor(Math.random() * QUOTES.length)]}"`;
            
            // Îã§ÌÅ¨Î™®Îìú
            const savedTheme = localStorage.getItem('theme');
            if(savedTheme) document.body.setAttribute('data-theme', savedTheme);
        });

        // --- Core Logic ---
        function saveData() {
            localStorage.setItem('studyApp_v3', JSON.stringify(state));
        }

        function loadData() {
            const data = localStorage.getItem('studyApp_v3');
            if(data) {
                const parsed = JSON.parse(data);
                state.todos = parsed.todos || [];
                state.logs = parsed.logs || [];
                state.streak = parsed.streak || { count: 0, lastDate: null };
                state.dday = parsed.dday || null;
                // Timer resets on reload logic is safer
            }
            // Memo is separate
            document.getElementById('memoPad').value = localStorage.getItem('studyApp_memo_v3') || "";
            if(state.dday) document.getElementById('ddayInput').value = state.dday;
        }

        // --- Feature: White Noise (Audio API) ---
        let audioCtx, noiseNode, gainNode;
        let isNoiseOn = false;

        function toggleNoise() {
            const btn = document.getElementById('noiseBtn');
            if (!isNoiseOn) {
                // Init Audio Context (Must be user triggered)
                if (!audioCtx) {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    audioCtx = new AudioContext();
                    const bufferSize = audioCtx.sampleRate * 2; // 2 seconds buffer
                    const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
                    const data = buffer.getChannelData(0);

                    // Brownian noise generation
                    let lastOut = 0;
                    for (let i = 0; i < bufferSize; i++) {
                        const white = Math.random() * 2 - 1;
                        lastOut = (lastOut + (0.02 * white)) / 1.02;
                        data[i] = lastOut * 3.5; 
                        data[i] *= 0.1; // Volume scaling
                    }

                    noiseNode = audioCtx.createBufferSource();
                    noiseNode.buffer = buffer;
                    noiseNode.loop = true;
                    gainNode = audioCtx.createGain();
                    noiseNode.connect(gainNode);
                    gainNode.connect(audioCtx.destination);
                    noiseNode.start();
                } else {
                    audioCtx.resume();
                }
                // Fade in
                gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(1, audioCtx.currentTime + 1);
                
                isNoiseOn = true;
                btn.innerText = "ON";
                btn.style.background = "var(--text-main)";
                btn.style.color = "var(--bg-card)";
            } else {
                // Fade out
                gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);
                setTimeout(() => { if(audioCtx) audioCtx.suspend(); }, 500);
                
                isNoiseOn = false;
                btn.innerText = "OFF";
                btn.style.background = "transparent";
                btn.style.color = "var(--text-sub)";
            }
        }

        // --- Feature: Streak ---
        function checkStreak() {
            const today = new Date().toLocaleDateString();
            if (state.streak.lastDate !== today) {
                // Ïñ¥Ï†ú ÎÇ†Ïßú Í≥ÑÏÇ∞
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayStr = yesterday.toLocaleDateString();

                if (state.streak.lastDate === yesterdayStr) {
                    state.streak.count++;
                } else {
                    // ÌïòÎ£® Í±¥ÎÑàÎúÄ or Ï≤òÏùå
                    state.streak.count = 1; 
                }
                state.streak.lastDate = today;
                saveData();
            }
            document.getElementById('streakDisplay').innerText = state.streak.count;
        }

        // --- Feature: Timer ---
        function setMode(mode) {
            timerAction('pause');
            state.timer.mode = mode;
            state.timer.time = (mode === 'pomodoro') ? 25 * 60 : 0;
            
            document.getElementById('modeStopwatch').className = mode === 'stopwatch' ? 'active' : '';
            document.getElementById('modePomodoro').className = mode === 'pomodoro' ? 'active' : '';
            updateTimerUI();
        }

        function timerAction(action) {
            if(action === 'start') {
                if(state.timer.isRunning) return;
                state.timer.isRunning = true;
                state.timer.interval = setInterval(() => {
                    if(state.timer.mode === 'stopwatch') {
                        state.timer.time++;
                    } else {
                        if(state.timer.time > 0) state.timer.time--;
                        else {
                            timerAction('pause');
                            addLog("üçÖ Pomodoro Session Completed");
                            alert("Focus session complete!");
                            state.timer.time = 25 * 60;
                        }
                    }
                    updateTimerUI();
                }, 1000);
            } else if(action === 'pause') {
                state.timer.isRunning = false;
                clearInterval(state.timer.interval);
            } else if(action === 'reset') {
                timerAction('pause');
                state.timer.time = (state.timer.mode === 'pomodoro') ? 25 * 60 : 0;
                updateTimerUI();
            }
        }

        function updateTimerUI() {
            const sec = state.timer.time;
            const h = String(Math.floor(sec / 3600)).padStart(2, '0');
            const m = String(Math.floor((sec % 3600) / 60)).padStart(2, '0');
            const s = String(sec % 60).padStart(2, '0');
            document.getElementById('timerDisplay').innerText = `${h}:${m}:${s}`;
        }

        // --- Feature: Todos ---
        function addTodo() {
            const input = document.getElementById('todoInput');
            const tag = document.getElementById('todoTag');
            const text = input.value.trim();
            if(!text) return;

            state.todos.push({ id: Date.now(), text, tag: tag.value, done: false });
            input.value = '';
            saveData();
            renderTodos();
        }

        function toggleTodo(id) {
            const idx = state.todos.findIndex(t => t.id === id);
            if(idx > -1) {
                state.todos[idx].done = !state.todos[idx].done;
                if(state.todos[idx].done) addLog(`Done: ${state.todos[idx].text}`);
                saveData();
                renderTodos();
            }
        }

        function deleteTodo(id) {
            state.todos = state.todos.filter(t => t.id !== id);
            saveData();
            renderTodos();
        }

        function renderTodos() {
            const list = document.getElementById('todoList');
            list.innerHTML = '';
            let done = 0;
            state.todos.forEach(t => {
                if(t.done) done++;
                const li = document.createElement('li');
                li.className = t.done ? 'completed' : '';
                li.innerHTML = `
                    <div style="display:flex; align-items:center;">
                        <div class="check-circle ${t.done?'checked':''}" onclick="toggleTodo(${t.id})"></div>
                        <span class="tag-pill">${t.tag}</span>
                        <span>${t.text}</span>
                    </div>
                    <button onclick="deleteTodo(${t.id})" style="border:none; padding:5px; opacity:0.5;">‚úï</button>
                `;
                list.appendChild(li);
            });
            document.getElementById('taskCount').innerText = `(${done}/${state.todos.length})`;
        }

        // --- Feature: Log & D-Day ---
        function addLog(msg) {
            const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            state.logs.unshift({ time, msg });
            if(state.logs.length > 20) state.logs.pop();
            saveData();
            renderLogs();
        }

        function renderLogs() {
            document.getElementById('logList').innerHTML = state.logs.map(l => `
                <div class="log-row"><span>${l.msg}</span><span>${l.time}</span></div>
            `).join('');
        }

        function renderAll() {
            renderTodos();
            renderLogs();
            updateDday();
            updateTimerUI();
            checkStreak();
        }

        // Events
        document.getElementById('todoInput').addEventListener('keypress', e => { if(e.key === 'Enter') addTodo(); });
        
        document.getElementById('ddayInput').addEventListener('change', (e) => {
            state.dday = e.target.value;
            saveData();
            updateDday();
        });

        document.getElementById('memoPad').addEventListener('input', (e) => {
            localStorage.setItem('studyApp_memo_v3', e.target.value);
        });

        function updateDday() {
            if(!state.dday) return;
            const target = new Date(state.dday);
            const today = new Date();
            today.setHours(0,0,0,0);
            const diff = Math.ceil((target - today) / (1000*60*60*24));
            const disp = document.getElementById('ddayDisplay');
            if(diff > 0) disp.innerText = `D-${diff}`;
            else if(diff === 0) disp.innerText = "D-Day";
            else disp.innerText = `D+${Math.abs(diff)}`;
        }

        function toggleTheme() {
            const body = document.body;
            const isDark = body.getAttribute('data-theme') === 'dark';
            body.setAttribute('data-theme', isDark ? 'light' : 'dark');
            localStorage.setItem('theme', isDark ? 'light' : 'dark');
        }
    </script>
</body>
</html>
